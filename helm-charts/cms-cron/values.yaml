namespace: "dev-cms"

replicaCount: 1

maxSurge: 1 # 새 팟 생성
maxUnavailable: 1 # 생성되면 교체로 꺼질 팟 수

image:
  repository: 3654***4891.dkr.ecr.ap-northeast-2.amazonaws.com/ecr-dev-cms
  # This sets the pull policy for images.
  pullPolicy: Always
  # Overrides the image tag whose default is the chart appVersion.
  tag: "latest"

# Deployment 의 spec.template.spec.containers.name[0] 안의 obj
resources: # 컨테이너 리소스 제한 (노드 자원 보호 및 스케줄링용)
  requests: # 최소 보장 리소스 (스케줄러가 노드 선택 시 참고) (1000m = 1 CPU 코어, 100m = 0.1 CPU)
    cpu: "300m" # 0.300 CPU core
    memory: "500Mi"
  limits: # 최대 사용 가능 리소스 (초과 시 CPU throttling, 메모리는 OOMKilled)
    cpu: "600m" # 0.6 CPU core
    memory: "700Mi"
# ============ Health Check Probes ============
# 크론 서비스는 포트 노출 없이 exec probe로 프로세스 생존 체크
startupProbe: # 앱 초기 기동 체크
  exec:
    command:
      - /bin/sh
      - -c
      - pgrep -f 'node' || exit 1
  periodSeconds: 5 # 5초마다 체크
  failureThreshold: 12 # 12번 실패 시 컨테이너 재시작 (5초 × 12 = 최대 60초 대기)
livenessProbe: # 앱 생존 체크 (실패 시 컨테이너 재시작)
  exec:
    command:
      - /bin/sh
      - -c
      - pgrep -f 'node' || exit 1
  initialDelaySeconds: 10 # startupProbe 성공 후 10초 뒤 첫 체크
  periodSeconds: 10 # 10초 간격으로 체크
  timeoutSeconds: 5 # 응답 대기 시간
# END Deployment 의 spec.containers

